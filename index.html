<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title>A simple map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.css' rel='stylesheet' />
    <link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute;
            top:65px;
            bottom:0;
            width:100%;
        }
        .marker {
            /*background-image: url('mapbox-icon.png');*/
            /*position: absolute;*/
            /*background-size: cover;*/
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
        }

        .gun{

        }

        .expl:after{
            content: "üí•";
        }

        .gun:before {
            display: block;
            content: "üî´";
            margin-left: -30px;
        }

        .gun:after {
            display: block;
            content: "üî´";
            margin-left: 60px;
            transform: scale(-1, 1);
        }

    </style>

</head>
<body>

<!--<div id="positionText"></div>-->
<!--<div class="marker em gun em-confused"></div>-->
<!--<i class="em em-confused"></i>-->

<div style="margin: 100px" class="marker gun em em-alien"></div>

<div id='map' style='width: 800px; height: 700px;'></div>
<div id="positionText" style="margin: 10px">Coordinates</div>

<script src='config.js'></script>

<script>
    var map;
    var ufos = [];
    var ufoSpreading = 30;
    var centerCoordinates = [0,0]
    var count = 0;
    var step = 0.00005;
    var smileSide = 0;
    var posText = document.getElementById("positionText");

    function createMap(x, y){
        mapboxgl.accessToken = accessToken;
        map = new mapboxgl.Map({
            container: 'map',
            style: mapboxStyle,
            center: [x, y],
            zoom: 17
        });
    }

    function initMap() {
        if (navigator.geolocation) {
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à–∏–ª, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ ShowPosition
            navigator.geolocation.getCurrentPosition(function(position) {
                centerCoordinates[0] = position.coords.longitude;
                centerCoordinates[1] = position.coords.latitude;
                createMap(position.coords.longitude, position.coords.latitude)
            });
        } else {
            // –ï—Å–ª–∏ –Ω–µ—Ç, –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
            posText.innerHTML = "–≠—Ç–æ—Ç –±—Ä–∞—É–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ";
            centerCoordinates[0] = 0;
            centerCoordinates[1] = 0;
        }
    };

    // initMap();



    var changeSmileSide = ()=> {
        var el = document.querySelector('.em-confused');
        if (smileSide === 0) {
            document.querySelector('.em-confused').style.transform = "scale(-1, 1)";
            smileSide = 1;
        } else {
            document.querySelector('.em-confused').style.transform = "scale(1, 1)";
            smileSide = 0;
        };
    };

    var removeEmoji = ()=> {
        var emojis = Array.from(document.querySelectorAll('.marker'));
        emojis.forEach( item => {
            item.parentNode.removeChild(item)
        } )
    }

    var geojsonGun = {
        type: 'FeatureCollection',
        features: [
            {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [36.386859, 49.926677]
                },
                properties: {
                    title: 'Mapbox',
                    description: 'Gun'
                },
            }
        ]
    };


    var moveMarkers = ()=>{
        count++;
        if(count < 50) step = 0.00005;
        if(count > 50) step = -0.00005;
        if(count === 100) count = 0;

        ufos.features[0].geometry.coordinates[0] += step;
        ufos.features[1].geometry.coordinates[0] += step;
        ufos.features[2].geometry.coordinates[0] -= step;
        ufos.features[3].geometry.coordinates[1] -= step;

        ufos.features.forEach((marker)=> {
            var el = document.createElement('div');
            el.className = 'marker em em-alien';
            new mapboxgl.Marker(el)
                .setLngLat(marker.geometry.coordinates)
                .addTo(map);
        });
    };

    var moveGun = ()=>{
        if (navigator.geolocation) {
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à–∏–ª, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ ShowPosition
            navigator.geolocation.getCurrentPosition(function(position) {
                geojsonGun.features[0].geometry.coordinates[0] = position.coords.longitude;
                geojsonGun.features[0].geometry.coordinates[1] = position.coords.latitude;
                var el = document.createElement('div');
                el.className = 'marker gun em em-confused';

                if (smileSide === 0) {
                    el.className = 'marker gun em em-confused';
                    smileSide = 1;
                } else {
                    el.className = 'marker gun em em-face_with_raised_eyebrow';
                    smileSide = 0;
                };

                new mapboxgl.Marker(el)
                    .setLngLat(geojsonGun.features[0].geometry.coordinates)
                    .addTo(map);

                posText.innerHTML = 'X: ' + geojsonGun.features[0].geometry.coordinates[0]
                    + "</br>" + 'Y: ' +  geojsonGun.features[0].geometry.coordinates[1];

            });
        } else {
            // –ï—Å–ª–∏ –Ω–µ—Ç, –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
            posText.innerHTML = "–≠—Ç–æ—Ç –±—Ä–∞—É–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ";
        }

    };




    function randomInteger(min, max) {
        var rand = min + Math.random() * (max + 1 - min);
        rand = Math.floor(rand);
        return rand;
    }

    function createUfoCoord() {
        // 36.388044799999996, 49.931878399999995
        var x = (((centerCoordinates[0].toFixed(4)))*10000 + randomInteger(-ufoSpreading, ufoSpreading)) / 10000;
        var y = (((centerCoordinates[1].toFixed(4)))*10000 + randomInteger(-ufoSpreading, ufoSpreading)) / 10000
        // console.log(x, y)
        return [x, y];
    }


    function createUfos() {
        // {id: 1, coordinates: [36.3889, 49.9321] },
        // {id: 2, coordinates: [36.3875, 49.9307] },
        for (var i=1; i < 20; i++){
            ufos.push({id: i, coordinates: createUfoCoord() })
        }
    }

    function moveUfos(){

        count++;
        if(count < 50) step = 0.00005;
        if(count > 50) step = -0.00005;
        if(count === 100) count = 0;
        ufos.forEach( (item, index) =>{

            if (index < ufos.length/4){
                item.coordinates[0] += step;
            }else if( index < ufos.length/2 ){
                item.coordinates[0] -= step;
            }else if( index < (ufos.length - ufos.length/4) ){
                item.coordinates[1] += step;
            }else {
                item.coordinates[1] -= step;
            }


            // if(index < ufos.length/2){
            //     item.coordinates[0] += step;
            // }else {
            //     item.coordinates[1] -= step;
            // }
        })

        ufos.forEach( ufo =>{
            var el = document.createElement('div');
            el.className = 'marker em em-alien';
            new mapboxgl.Marker(el)
                .setLngLat(ufo.coordinates)
                .addTo(map);
        } )
    }

    // initMap();
    // setTimeout( ()=>{
    //     createUfos()
    // }, 1900 )
    //
    // setInterval( ()=>{
    //     // addUfo()
    //     removeEmoji();
    //     moveUfos();
    //     moveGun();
    //     // changeSmileSide();
    // }, 2000 )


</script>

</body>
</html>

